play with duckdb and dbplyr

```{r}
library(tidyverse)
library(duckdb)
```

turn mtcars into a database

```{r}
con <- dbConnect(duckdb())
dbWriteTable(con, "mt_cars", mtcars)
```

```{r}
tbl(con, "mt_cars")
```

summarize using dbplyr

```{r}
tbl(con, "mt_cars") %>% 
  group_by(cyl) %>% 
  summarize(m = mean(wt)) -> summ
```

```{r}
summ
```

same thing, but save to a file

```{r}
con2 <- dbConnect(duckdb("mt_cars.db"))
dbWriteTable(con2, "mt_cars", mtcars)
tbl(con2, "mt_cars") %>% 
  group_by(cyl) %>% 
  summarize(mean_mpg = mean(mpg), 
            sd_mpg = sd(mpg)) -> summ
```

```{r}
summ %>% collect()
```

what about a plot?

```{r}
tbl(con2, "mt_cars") %>% 
  ggplot(aes(x = wt, y = mpg)) + geom_point()
```

read from a file

```{r}
con3 <- dbConnect(duckdb("mt_cars.db", read_only = TRUE))
tbl(con3, "mt_cars") 
```

